CREATE DATABASE bank;
use bank;

SET SQL_SAFE_UPDATES = 0;

UPDATE bank
SET BALANCE_AMT = ABS(BALANCE_AMT);

SET SQL_SAFE_UPDATES = 1; 


SELECT * FROM bank;

SELECT TRANSACTION_DETAILS , WITHDRAWAL_AMT 
FROM bank
WHERE WITHDRAWAL_AMT >0;


SELECT TRANSACTION_DETAILS , DEPOSIT_AMT 
FROM bank
WHERE DEPOSIT_AMT >0;


SELECT * FROM bank
WHERE TRANS_DATE = '2019-03-05' ;


SELECT ACCOUNT_NO ,COUNT(*) AS TOTAL
FROM bank
group by ACCOUNT_NO;


SELECT TRANSACTION_DETAILS , BALANCE_AMT
FROM bank
WHERE BALANCE_AMT >100000;


SELECT TRANSACTION_DETAILS
FROM bank
WHERE WITHDRAWAL_AMT > DEPOSIT_AMT;


SELECT DISTINCT TRANSACTION_DETAILS
FROM bank;


SELECT ACCOUNT_NO , SUM(DEPOSIT_AMT) AS DEPOSITE_AMOUNT
FROM bank
GROUP BY ACCOUNT_NO;


SELECT ACCOUNT_NO , SUM(WITHDRAWAL_AMT) AS WITHDRAW_AMOUNT
FROM bank
GROUP BY ACCOUNT_NO;

SELECT * FROM bank
ORDER BY DEPOSIT_AMT DESC
LIMIT 1;


SELECT * FROM bank
ORDER BY WITHDRAWAL_AMT DESC
LIMIT 1;


SELECT * FROM bank
WHERE WITHDRAWAL_AMT = 0 AND DEPOSIT_AMT = 0;


SELECT ACCOUNT_NO , AVG(WITHDRAWAL_AMT) AS AVG_WTHDRAW_AMT 
FROM bank
GROUP BY ACCOUNT_NO
ORDER BY ACCOUNT_NO DESC;


SELECT ACCOUNT_NO , AVG(DEPOSIT_AMT) AS AVG_DEPOSITE_AMT 
FROM bank
GROUP BY ACCOUNT_NO
ORDER BY ACCOUNT_NO DESC;

SELECT * FROM bank
ORDER BY BALANCE_AMT DESC;

SELECT ACCOUNT_NO,
       MIN(TRANS_DATE) AS FIRST_TRANSACTION,
       MAX(TRANS_DATE) AS LAST_TRANSACTION
FROM bank
GROUP BY ACCOUNT_NO;

SELECT ACCOUNT_NO,
       SUM(DEPOSIT_AMT) AS TOTAL_DEPOSIT,
       SUM(WITHDRAWAL_AMT) AS TOTAL_WITHDRAWAL
FROM bank
GROUP BY ACCOUNT_NO
HAVING SUM(DEPOSIT_AMT) > SUM(WITHDRAWAL_AMT);


SELECT DISTINCT ACCOUNT_NO
FROM bank
WHERE BALANCE_AMT < 5000;


SELECT ACCOUNT_NO,
       SUM(DEPOSIT_AMT - WITHDRAWAL_AMT) AS NET_CHANGE
FROM bank
GROUP BY ACCOUNT_NO;


SELECT ACCOUNT_NO, TRANS_DATE, WITHDRAWAL_AMT
FROM bank
WHERE WITHDRAWAL_AMT > 10000
ORDER BY ACCOUNT_NO, TRANS_DATE;


SELECT ACCOUNT_NO,
       SUM(BALANCE_AMT) AS TOTAL_BALANCE,
       RANK() OVER (ORDER BY SUM(BALANCE_AMT) DESC) AS RANKING
FROM bank
GROUP BY ACCOUNT_NO;


SELECT ACCOUNT_NO,
       MONTH(TRANS_DATE) AS MONTH_NO,
       SUM(DEPOSIT_AMT) AS TOTAL_DEPOSIT
FROM bank
GROUP BY ACCOUNT_NO, MONTH(TRANS_DATE)
ORDER BY TOTAL_DEPOSIT DESC;


SELECT *
FROM bank
WHERE WITHDRAWAL_AMT > 0.5 * BALANCE_AMT;

SELECT ACCOUNT_NO,
       AVG(BALANCE_AMT) AS AVG_DAILY_BALANCE
FROM bank
GROUP BY ACCOUNT_NO;


SELECT ACCOUNT_NO,
       CASE 
           WHEN SUM(DEPOSIT_AMT > 0) > SUM(WITHDRAWAL_AMT > 0) THEN 'Deposit'
           ELSE 'Withdrawal'
       END AS MOST_FREQUENT_TYPE
FROM bank
GROUP BY ACCOUNT_NO;


SELECT ACCOUNT_NO,
       SUM(DEPOSIT_AMT) AS TOTAL_DEPOSIT,
       SUM(WITHDRAWAL_AMT) AS TOTAL_WITHDRAWAL,
       MAX(BALANCE_AMT) AS CURRENT_BALANCE
FROM bank
GROUP BY ACCOUNT_NO;
